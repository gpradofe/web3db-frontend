# Deployment

The Web3DB API solution can be easily deployed using Docker Compose, which provides a consistent and reproducible environment for running the application. This guide will walk you through the deployment process and local certificate creation for development purposes.

## Prerequisites

Before you begin, ensure that you have the following prerequisites:

- Docker: Make sure you have Docker installed on your machine. If you don't have Docker installed, you can download and install it from the official website: [https://www.docker.com/get-started](https://www.docker.com/get-started)
- Docker Compose: Docker Compose is included with Docker Desktop for Windows and macOS. For Linux, you may need to install it separately. Follow the instructions here: [https://docs.docker.com/compose/install/](https://docs.docker.com/compose/install/)

## Project Structure

Ensure that your project has the following files in the root directory:

1. `docker-compose.yml`: Defines the services and configuration for Docker Compose.
2. `Dockerfile`: Contains instructions for building the Docker image.

## Local Certificate Creation

For local development and testing, the Dockerfile includes steps to generate a development certificate. This certificate is not trusted by default, but it's sufficient for development purposes. Here's how the certificate is created:

1. In the Dockerfile, we use the `dotnet dev-certs` command to generate a self-signed certificate:

   ```dockerfile
   RUN dotnet dev-certs https -ep /app/aspnetapp.pfx -p password
   ```

2. The certificate is then copied to the final image:

   ```dockerfile
   COPY --from=build /app/aspnetapp.pfx /https/aspnetapp.pfx
   ```

3. Environment variables are set to configure Kestrel to use this certificate:

   ```dockerfile
   ENV ASPNETCORE_URLS="https://+:443;http://+:80"
   ENV ASPNETCORE_HTTPS_PORT=443
   ENV ASPNETCORE_Kestrel__Certificates__Default__Path=/https/aspnetapp.pfx
   ENV ASPNETCORE_Kestrel__Certificates__Default__Password=password
   ```

## Deploying with Docker Compose

To deploy the Web3DB API solution using Docker Compose, follow these steps:

1. Open a terminal and navigate to the root directory of your project (where the `docker-compose.yml` and `Dockerfile` are located).

2. Build and start the Docker containers:

   ```bash
   docker-compose up -d --build
   ```

   This command will build the Docker image using the provided `Dockerfile`, create and start the containers defined in the `docker-compose.yml` file.

## Accessing the Application

After the containers are up and running, you can access the Web3DB API application by opening a web browser and navigating to:

- `http://localhost` (for HTTP)
- `https://localhost` (for HTTPS)

Note: When accessing the application via HTTPS, you may see a browser warning about an untrusted certificate. This is expected for the development certificate. You can proceed by accepting the risk (the exact process varies by browser).

If you are deploying the application on a remote server, replace `localhost` with the server's IP address or domain name.

## Platform-Specific Notes

### Windows

The development certificate should work out of the box. No additional steps are required.

### macOS

You may see a security warning when accessing the HTTPS endpoint. You can temporarily trust the certificate for your current session:

1. Click on the warning icon in the address bar.
2. Click on "View Certificate".
3. Expand the "Trust" section and select "Always trust" for "When using this certificate".

### Linux

Most Linux distributions will not trust the development certificate by default. You can either:

1. Use the HTTP endpoint for development purposes.
2. Add an exception for the certificate in your browser when prompted.
3. For a more permanent solution, you can export the certificate from the container and add it to your system's trust store (the exact process varies by distribution).

## Additional Docker Compose Commands

Here are some useful Docker Compose commands for managing the Web3DB API containers:

- Stop the running containers:

  ```bash
  docker-compose down
  ```

- Start the containers:

  ```bash
  docker-compose up -d
  ```

- View the logs of the containers:

  ```bash
  docker-compose logs
  ```

- Rebuild the images and restart the containers:
  ```bash
  docker-compose up -d --build
  ```

## Troubleshooting

If you encounter any issues accessing the application via HTTPS:

1. Ensure that both port 80 and 443 are exposed and not in use by other applications.
2. Check the container logs for any error messages:
   ```bash
   docker-compose logs web3db-api
   ```
3. Verify that the certificate is being generated correctly by inspecting the container:
   ```bash
   docker exec -it <container_id> ls /https
   ```
   You should see the `aspnetapp.pfx` file listed.

## Conclusion

By following this guide, you should be able to deploy the Web3DB API solution using Docker Compose with a development certificate. The process is designed to work across all platforms (Windows, macOS, and Linux), although you may need to handle certificate trust warnings differently depending on your operating system and browser.

Remember that this setup is intended for development purposes. For production deployments, you should use a properly trusted SSL/TLS certificate.

If you encounter any issues or need further assistance, please refer to the Docker and Docker Compose documentation or reach out to our support team.
